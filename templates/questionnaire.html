
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>牛奶知识答题</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style type="text/css">
        body {
            background: #ccc;
        }
    </style>
</head>
<body>
    <h1 class="text-center">你会喝奶吗？</h1>
    <div class="modal fade" id="info" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">信息完善</h4>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label for="txt_departmentname">姓名</label>
                        <input type="text" name="txt_departmentname" class="form-control" id="username" placeholder="姓名">
                    </div>
                    <div class="form-group">
                        <label for="txt_departmentname">手机号</label>
                        <input id="phone" type="text" name="txt_departmentname" class="form-control" id="phone" placeholder="手机号">
                    </div>
                    <div class="form-group">
                        <label for="txt_departmentname">地址</label>
                        <input type="text" name="txt_departmentname" class="form-control" id="address" placeholder="学校-宿舍">
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" id="to_success" class="btn btn-primary btn-lg btn-block ladda-button" data-dismiss="modal" data-style="zoom-out" data-size="l"><span class='ladda-label'>提交</span> </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="result" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">结果</h4>
                </div>
                <div class="modal-body">
                    <p class="text-center">获得<span id="true_name"></span>称号</p>
                    <p class="text-center">得到<span id="milk_num"></span>瓶鲜奶</p>
                    <p class="text-center" id="to_info" style="display: none;">请<a href="#">点击完善信息</a>我们将为你送出奖品</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-lg btn-block ladda-button" data-dismiss="modal" data-style="zoom-out" data-size="l"><span class='ladda-label'>确定</span> </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="success" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">提交成功</h4>
                </div>
                <div class="modal-body">
                    <p class="text-center">提交成功，我们将尽快为您派送，请耐心等待</p>
                </div>
            </div>
        </div>
    </div>

    <div id="main" class="container"><form id="form">
        <div class="panel panel-default" style="margin-top: 20px">
            <div class="panel-heading" id="q1"> 纯奶和鲜奶主要区别在于<span class="red"></span> </div>
            <div class="panel-body">
                <ul class="list-unstyled">
                    <li> <label> <input type="radio" name="q1" value="1"   /> <span id="q1_1"> </span> </label> </li>
                    <li> <label> <input type="radio" name="q1" value="2" /> <span id="q1_2"> </span> </label> </li>
                </ul>
            </div>
        </div>
        <div class="panel panel-default" style="margin-top: 20px">
            <div class="panel-heading" id="q2"> 纯奶和鲜奶主要区别在于<span class="red"></span> </div>
            <div class="panel-body">
                <ul class="list-unstyled">
                    <li> <label> <input type="radio" name="q2" value="1"   /> <span id="q2_1"> </span> </label> </li>
                    <li> <label> <input type="radio" name="q2" value="2" /> <span id="q2_2"> </span> </label> </li>
                </ul>
            </div>
        </div>
        <div class="panel panel-default" style="margin-top: 20px">
            <div class="panel-heading" id="q3"> 纯奶和鲜奶主要区别在于<span class="red"></span> </div>
            <div class="panel-body">
                <ul class="list-unstyled">
                    <li> <label> <input type="radio" name="q3" value="1"   /> <span id="q3_1"> </span> </label> </li>
                    <li> <label> <input type="radio" name="q3" value="2" /> <span id="q3_2"> </span> </label> </li>
                </ul>
            </div>
        </div>

    </form>
    <button type="submit" class="btn btn-primary col-xs-5 col-xs-offset-3" id="submit">提交</button>
        </div>

    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript">
        var COUNT=0;
        var NICK="";
        question = [
            {
                "text": "纯奶和鲜奶主要区别在于",
                "answer1": "灭菌方法",
                "answer2": "蛋白质含量",
                "t_answer": '1'
            },
            {
                "text": "鲜奶又叫",
                "answer1": "纯牛奶",
                "answer2": "巴氏奶",
                "t_answer": '2'
            },
            {
                "text": "纯奶的灭菌温度为多少度以上",
                "answer1": "125度",
                "answer2": "135度",
                "t_answer": '2'
            },
            {
                "text": "鲜奶的灭菌温度为",
                "answer1": "65~75度",
                "answer2": "75~85度",
                "t_answer": '2'
            },
            {
                "text": "鲜奶的保质期一般在几天之内",
                "answer1": "2-3天",
                "answer2": "5-7天",
                "t_answer": '1'
            },
            {
                "text": "高温灭菌后的纯奶哪种物质不宜被人体吸收",
                "answer1": "钙",
                "answer2": "磷",
                "t_answer": '1'
            },
            {
                "text": "鲜奶中的哪种物质是纯奶的1800倍",
                "answer1": "乳清蛋白",
                "answer2": "乳铁蛋白",
                "t_answer": '2'
            },
        ]
        var question_index = new Array();
        function updateQuestion() {
            question_index_set = new Set();
            while( question_index_set.size<3 )
                question_index_set.add( Math.round(Math.random()*6) );
            console.log(question_index)

            question_index = Array.from(question_index_set)
            $("#q1").text( question[question_index[0]].text );
            $("#q2").text( question[question_index[1]].text );
            $("#q3").text( question[question_index[2]].text );
            $("#q1_1").text( question[question_index[0]].answer1 );
            $("#q2_1").text( question[question_index[1]].answer1 );
            $("#q3_1").text( question[question_index[2]].answer1 );
            $("#q1_2").text( question[question_index[0]].answer2 );
            $("#q2_2").text( question[question_index[1]].answer2 );
            $("#q3_2").text( question[question_index[2]].answer2 );
        }

        $("#submit").click(function() {
            if (localStorage.questionnaire == "1") {
                $("#success").modal('show');
                $("#main").hide();
            }
            else {
                a = $("input[name='q1']:checked").val() == question[question_index[0]].t_answer;
                b = $("input[name='q2']:checked").val() == question[question_index[1]].t_answer;
                c = $("input[name='q3']:checked").val() == question[question_index[2]].t_answer;
                console.log(a+b+c)
                // $("#true_num").text(a+b+c)
                switch (a+b+c) {
                    case 0: $("#true_name").text("喝奶小白"); nick="喝奶小白"; $("#milk_num").text("0"); COUNT=0; break;
                    case 1: $("#true_name").text("喝奶小白"); nick="喝奶小白"; $("#milk_num").text("0"); COUNT=0; break;
                    case 2: $("#true_name").text("喝奶小白"); nick="喝奶小白"; $("#milk_num").text("0"); COUNT=0; break;
                    case 3: $("#true_name").text("喝奶达人"); nick="喝奶达人"; $("#milk_num").text("1"); COUNT=1; $("#to_info").show(); break;
                }
                $("#result").modal('show')
                updateQuestion();
            }
        })
        $("#to_info").click(function() {
            $("#result").hide('hide');
            if (COUNT==1)
                $("#info").modal('show');
        })
        $("#to_success").click(function() {
           if (localStorage.questionnaire == "1")
               return false;
            $.ajax({
                url: "/other/questionnaire/",
                type: "POST",
                dataType: "json",
                data: {
                    username: $("#username").val(),
                    phone: $("#phone").val(),
                    address: $("#address").val(),
                    nick: NICK,
                    count: COUNT,
                },
                success: function (res) {
                    if (res.status = 1) {
                        $("#info").hide('hide');
                        $("#success").modal('show');
                        localStorage.questionnaire = "1";
                    } else {
                        alert("网络出错，就稍后重试");
                    }
                },
                error: function () {
                    alert("网络出错，就稍后重试")
                }
            })
        });
        updateQuestion();
    </script>
</body>
</html>